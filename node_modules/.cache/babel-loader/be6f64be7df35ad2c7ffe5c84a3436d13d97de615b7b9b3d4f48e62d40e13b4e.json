{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.heartbeat = heartbeat;\nvar constants_1 = require(\"./constants\");\nfunction heartbeat(ws, lastMessageTime, options) {\n  var _a = options || {},\n    _b = _a.interval,\n    interval = _b === void 0 ? constants_1.DEFAULT_HEARTBEAT.interval : _b,\n    _c = _a.timeout,\n    timeout = _c === void 0 ? constants_1.DEFAULT_HEARTBEAT.timeout : _c,\n    _d = _a.message,\n    message = _d === void 0 ? constants_1.DEFAULT_HEARTBEAT.message : _d;\n  var heartbeatInterval = setInterval(function () {\n    if (lastMessageTime.current + timeout <= Date.now()) {\n      console.warn(\"Heartbeat timed out, closing connection, last message was seen \".concat(Date.now() - lastMessageTime.current, \"ms ago\"));\n      ws.close();\n    } else {\n      if (lastMessageTime.current + interval <= Date.now()) {\n        try {\n          if (typeof message === 'function') {\n            ws.send(message());\n          } else {\n            ws.send(message);\n          }\n        } catch (err) {\n          console.error(\"Heartbeat failed, closing connection\", err instanceof Error ? err.message : err);\n          ws.close();\n        }\n      }\n    }\n  }, interval);\n  ws.addEventListener(\"close\", function () {\n    clearInterval(heartbeatInterval);\n  });\n  return function () {};\n}","map":{"version":3,"names":["exports","heartbeat","constants_1","require","ws","lastMessageTime","options","_a","_b","interval","DEFAULT_HEARTBEAT","_c","timeout","_d","message","heartbeatInterval","setInterval","current","Date","now","console","warn","concat","close","send","err","error","Error","addEventListener","clearInterval"],"sources":["/home/kacper/drop-n-share-frontend/node_modules/react-use-websocket/src/lib/heartbeat.ts"],"sourcesContent":["import { MutableRefObject } from \"react\";\nimport { DEFAULT_HEARTBEAT } from \"./constants\";\nimport { HeartbeatOptions } from \"./types\";\n\nexport function heartbeat(ws: WebSocket, lastMessageTime: MutableRefObject<number>, options?: HeartbeatOptions): () => void {\n  const {\n    interval = DEFAULT_HEARTBEAT.interval,\n    timeout = DEFAULT_HEARTBEAT.timeout,\n    message = DEFAULT_HEARTBEAT.message,\n  } = options || {};\n\n  const heartbeatInterval = setInterval(() => {\n    if (lastMessageTime.current + timeout <= Date.now()) {\n      console.warn(`Heartbeat timed out, closing connection, last message was seen ${Date.now() - lastMessageTime.current}ms ago`);\n      ws.close();\n    } else {\n      if (lastMessageTime.current + interval <= Date.now()) {\n        try {\n          if (typeof message === 'function') {\n            ws.send(message());\n          } else {\n            ws.send(message);\n          }\n        } catch (err: unknown) {\n          console.error(`Heartbeat failed, closing connection`, err instanceof Error ? err.message : err);\n          ws.close();\n        }\n\n      }\n    }\n  }, interval);\n\n  ws.addEventListener(\"close\", () => {\n    clearInterval(heartbeatInterval);\n  });\n\n\n  return () => { };\n}\n"],"mappings":";;;;;AAIAA,OAAA,CAAAC,SAAA,GAAAA,SAAA;AAHA,IAAAC,WAAA,GAAAC,OAAA;AAGA,SAAgBF,SAASA,CAACG,EAAa,EAAEC,eAAyC,EAAEC,OAA0B;EACtG,IAAAC,EAAA,GAIFD,OAAO,IAAI,EAAE;IAHfE,EAAA,GAAAD,EAAA,CAAAE,QAAqC;IAArCA,QAAQ,GAAAD,EAAA,cAAGN,WAAA,CAAAQ,iBAAiB,CAACD,QAAQ,GAAAD,EAAA;IACrCG,EAAA,GAAAJ,EAAA,CAAAK,OAAmC;IAAnCA,OAAO,GAAAD,EAAA,cAAGT,WAAA,CAAAQ,iBAAiB,CAACE,OAAO,GAAAD,EAAA;IACnCE,EAAA,GAAAN,EAAA,CAAAO,OAAmC;IAAnCA,OAAO,GAAAD,EAAA,cAAGX,WAAA,CAAAQ,iBAAiB,CAACI,OAAO,GAAAD,EACpB;EAEjB,IAAME,iBAAiB,GAAGC,WAAW,CAAC;IACpC,IAAIX,eAAe,CAACY,OAAO,GAAGL,OAAO,IAAIM,IAAI,CAACC,GAAG,EAAE,EAAE;MACnDC,OAAO,CAACC,IAAI,CAAC,kEAAAC,MAAA,CAAkEJ,IAAI,CAACC,GAAG,EAAE,GAAGd,eAAe,CAACY,OAAO,WAAQ,CAAC;MAC5Hb,EAAE,CAACmB,KAAK,EAAE;IACZ,CAAC,MAAM;MACL,IAAIlB,eAAe,CAACY,OAAO,GAAGR,QAAQ,IAAIS,IAAI,CAACC,GAAG,EAAE,EAAE;QACpD,IAAI;UACF,IAAI,OAAOL,OAAO,KAAK,UAAU,EAAE;YACjCV,EAAE,CAACoB,IAAI,CAACV,OAAO,EAAE,CAAC;UACpB,CAAC,MAAM;YACLV,EAAE,CAACoB,IAAI,CAACV,OAAO,CAAC;UAClB;QACF,CAAC,CAAC,OAAOW,GAAY,EAAE;UACrBL,OAAO,CAACM,KAAK,CAAC,sCAAsC,EAAED,GAAG,YAAYE,KAAK,GAAGF,GAAG,CAACX,OAAO,GAAGW,GAAG,CAAC;UAC/FrB,EAAE,CAACmB,KAAK,EAAE;QACZ;MAEF;IACF;EACF,CAAC,EAAEd,QAAQ,CAAC;EAEZL,EAAE,CAACwB,gBAAgB,CAAC,OAAO,EAAE;IAC3BC,aAAa,CAACd,iBAAiB,CAAC;EAClC,CAAC,CAAC;EAGF,OAAO,aAAQ,CAAC;AAClB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}